//
// Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc purus mi, consectetur malesuada lectus eu, semper semper lorem. Proin tempus mi mattis pharetra convallis. Proin suscipit lectus augue, id euismod ligula euismod non. Etiam enim metus, pulvinar id libero facilisis, sollicitudin iaculis magna. Mauris tempor bibendum leo ut pellentesque. Etiam placerat bibendum nisl. Donec dictum vel augue id fermentum. Suspendisse potenti. Proin vulputate, tellus sit amet malesuada aliquet, nisl arcu elementum sapien, aliquam faucibus ligula mi quis nibh. Duis eu congue elit. Nullam vel cursus enim. Maecenas varius libero at pretium auctor. Aenean iaculis nec risus quis elementum. Morbi at cursus ligula, et imperdiet velit. Aenean sed augue aliquam, dapibus neque et, fermentum massa. Nunc euismod lacus quis sapien tincidunt elementum. Donec nec cursus elit. Fusce metus metus, volutpat vel lorem id, volutpat rutrum elit. Phasellus rhoncus egestas odio, non interdum enim pretium eu. Aliquam aliquam ligula eu metus pretium auctor eu nec sapien. Vivamus ac lorem dapibus, fermentum diam sit amet, molestie risus. Integer fermentum fermentum scelerisque. Sed dictum ex eget neque efficitur venenatis. Nunc facilisis purus elit, nec ullamcorper libero fermentum ac. Mauris vel metus condimentum arcu auctor scelerisque ut nec lacus. Duis dapibus lorem et gravida dignissim. Integer massa elit, tristique eu odio at, viverra consectetur sapien. Nulla pretium sem sit amet urna venenatis rhoncus. Mauris ac ligula id diam dictum interdum. Sed ac congue sapien, a euismod leo. Cras a imperdiet est, a viverra eros. Vivamus euismod maximus sapien, non lacinia sapien pharetra et. Pellentesque feugiat sed diam sed mollis. Donec eget blandit lectus, vitae hendrerit metus. Interdum et malesuada fames ac ante ipsum primis in faucibus. Morbi a eros dolor. Quisque ut velit interdum, aliquet justo et, viverra turpis. Nunc a ultricies velit. Nam mattis purus elit, quis tincidunt lacus blandit a. Curabitur at velit quis elit aliquam mattis quis quis justo. Nunc sit amet eleifend nibh. Aenean sed lectus lacus. Donec sollicitudin ligula accumsan dictum pulvinar. Sed lobortis ut leo vel fermentum. Vivamus et congue ante, a vehicula metus. Nullam vel feugiat libero. Ut sed dui quis enim rhoncus ultricies. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Proin id dapibus dui. Aenean purus magna, tempor sit amet lorem sed, euismod varius quam. Fusce vel ex id libero fringilla sagittis. Nullam aliquet ex placerat libero rhoncus, iaculis feugiat velit gravida. Nulla ultricies, massa gravida venenatis mollis, magna ante imperdiet elit, sed pharetra urna lacus condimentum lorem. Nullam aliquam vitae mi sed pretium. Donec eu velit ut elit interdum semper. Nam sed purus nibh. Vestibulum lorem orci, maximus eget malesuada a, feugiat id tortor. Nam ullamcorper eu lacus quis efficitur. Maecenas auctor turpis non turpis ultrices iaculis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Phasellus enim tortor, pulvinar at tellus id, consequat aliquet nunc. Etiam rutrum tincidunt ornare. Vestibulum eget urna in velit ullamcorper suscipit sed et felis. Integer consectetur, ex sed rhoncus euismod, justo elit convallis arcu, eu accumsan leo neque sit amet magna. Morbi euismod eu eros sit amet rhoncus. Vivamus orci sem, tincidunt at luctus at, dictum eget felis. Praesent suscipit lorem id ipsum condimentum tempus non gravida nisi. Pellentesque consectetur ultricies tellus, at pretium orci interdum eget. Maecenas eu accumsan augue, ac placerat quam. Nulla sit amet est vitae massa ullamcorper suscipit. Nam scelerisque dictum neque vel aliquet. Morbi et sodales erat. In hac habitasse platea dictumst. Aenean a condimentum est, nec suscipit sem. Maecenas malesuada sem consectetur justo tempus tincidunt. Quisque suscipit sollicitudin lorem, vitae tempor felis. Donec suscipit lorem vel ipsum tincidunt, sed pharetra leo luctus. Aenean aliquam, massa vel pharetra euismod, nisl lorem tempor mi, id feugiat turpis est ac nisi. Pellentesque tempor orci et nisi congue posuere. Ut eleifend diam eu enim volutpat, at ornare justo fringilla. Fusce lorem diam, rhoncus nec luctus tempor, auctor ut massa. Quisque lobortis ultricies gravida. Suspendisse tempus risus eget tortor maximus tristique sit amet sit amet dui. Pellentesque eros diam, sodales nec metus sit amet, bibendum pharetra nulla. Duis mollis dictum odio, vitae varius arcu laoreet non. Cras in ipsum at dolor finibus rhoncus sit amet aliquam neque. Donec porta rhoncus nibh et mattis. Pellentesque in leo quis metus rhoncus tempus. Etiam ut lorem volutpat, posuere dolor id, semper magna. In sit amet pharetra leo. Praesent eget metus vitae turpis tincidunt lacinia nec nec tellus. Aenean laoreet convallis blandit. Fusce fermentum odio nec ultrices gravida. Mauris porttitor magna et orci hendrerit luctus. Nullam ut sodales enim. Aenean nunc nisi, condimentum sit amet posuere nec, volutpat eu nisl. Suspendisse potenti. Duis et tellus ut est tempus finibus. Aenean ultricies convallis magna, sit amet consectetur lacus cursus eu. Curabitur fermentum ullamcorper velit, sed vestibulum urna semper pharetra. Integer a dolor vel erat fringilla finibus eu sed felis. Praesent fringilla feugiat nisi eget rutrum. Nullam efficitur purus at scelerisque luctus. Fusce aliquet diam non placerat cursus. Duis malesuada fermentum eleifend. Praesent rutrum sed velit eget sodales. Vestibulum ac justo laoreet, ornare mi vitae, dapibus risus. Fusce in dui rutrum, consectetur libero sed, hendrerit sem. Integer ullamcorper sit amet arcu quis fermentum. Sed aliquam dapibus metus, et convallis eros eleifend eget. Maecenas nec sapien id purus vulputate feugiat. Nulla pellentesque enim viverra nulla rhoncus, venenatis consectetur lacus bibendum. Nam vulputate euismod dui porttitor molestie. Suspendisse pretium, augue euismod viverra pharetra, dui diam hendrerit sem, eget mollis dolor risus eget magna. Nunc viverra suscipit pharetra. Fusce ultricies tortor eros, non rutrum nisi maximus quis. Sed tincidunt erat nibh, vel vehicula sapien commodo vel. Nunc risus purus, bibendum id consequat in, mattis in dolor. Pellentesque at congue neque. Pellentesque pellentesque vehicula turpis vitae ultricies. Vivamus nec pretium nisl, a vestibulum orci. Nulla ultricies urna a dui porttitor, ut semper lectus vulputate. Duis sagittis fermentum nibh. Pellentesque auctor ante sit amet odio sodales, sit amet rhoncus velit fringilla. Vivamus et bibendum enim. Curabitur non aliquet mi. Aenean congue nisi sed est bibendum tincidunt. Donec vel sapien molestie, finibus arcu eget, congue nibh. Vestibulum eu rhoncus lectus. Curabitur non ante elit. Nulla risus mauris, ultricies vitae quam eu, tristique fringilla arcu. Donec quis lectus mollis, sollicitudin nulla ac, tincidunt enim. Mauris ac felis ac tortor consequat euismod at sed ante. Sed condimentum neque a neque auctor facilisis. Aliquam pretium vitae ex egestas pharetra. Vivamus sit amet leo nulla. Suspendisse eleifend commodo pharetra. Proin nec lectus consequat, mattis libero non, vehicula ex. Curabitur sit amet massa at est ultrices elementum sit amet ut enim. Praesent iaculis leo in tempus blandit. Nunc non ipsum quis diam auctor feugiat dignissim a orci. Vestibulum fermentum semper dui, sit amet ornare neque semper sed. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Mauris malesuada ipsum nec enim tincidunt fermentum. Nam ac porttitor justo. Curabitur hendrerit tellus sit amet dignissim aliquam. Integer non metus libero. Nulla auctor semper elit sed blandit. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Donec sagittis consectetur augue in aliquam. Pellentesque tortor lorem, luctus hendrerit rutrum id, dignissim at erat. Donec non elementum tortor. Interdum et malesuada fames ac ante ipsum primis in faucibus. Maecenas ac pulvinar dui. Curabitur in magna mauris. Maecenas vestibulum sagittis purus et porttitor. Phasellus at quam augue. Curabitur fermentum convallis elit sit amet gravida. Nam nunc eros, cursus id auctor non, pretium id orci. Duis elit ipsum, rutrum consequat vestibulum ut, maximus quis lacus. Mauris molestie dolor sit amet lacus lobortis imperdiet. Suspendisse quis diam quis sem sagittis molestie. Cras lobortis tristique ornare. Pellentesque eu sapien ultrices, malesuada justo vitae, ultrices enim. Duis mauris diam, ultrices nec tortor id, gravida sollicitudin quam. Vivamus ut felis et nunc fringilla tempus. Aliquam erat volutpat. Curabitur accumsan malesuada odio in facilisis. Quisque efficitur non ante quis convallis. Suspendisse potenti. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Donec nec commodo nulla. Aliquam placerat mauris at risus pharetra facilisis. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque malesuada vitae mi id lacinia. Suspendisse sit amet maximus justo. Quisque maximus felis sit amet turpis rutrum, non vestibulum nulla vehicula. Phasellus pulvinar lectus id velit molestie tempor. Donec lorem magna, blandit vitae dolor in, pellentesque feugiat metus. Nulla sit amet ex lectus. Sed ultrices purus sem, ut porta sapien tincidunt et. Nulla facilisi. Mauris ut diam vel eros convallis lobortis. Pellentesque magna erat, tempus et mollis et, rhoncus vitae justo. Sed pretium pretium neque, vel aliquet lorem pulvinar sit amet. Etiam mattis, eros quis varius porta, ante ex viverra nisi, eget tempor enim dolor sed odio. Sed suscipit nunc a orci posuere gravida. Mauris ut turpis ac tortor tempus rutrum. Maecenas vitae lorem volutpat, euismod nisl ut, rhoncus lectus. Aliquam dignissim tempus nisi a volutpat. Cras ac sodales lacus. Vestibulum luctus velit leo, et ultrices lacus mattis eu. Nulla hendrerit nisl purus, faucibus maximus mi efficitur at. Pellentesque id pellentesque ipsum. Suspendisse elit tortor.



const AWS = require('aws-sdk');
AWS.config.region = process.env.AWS_REGION || 'us-east-1';

// AWS.config.endpoint = 'http://localhost:8000';

const fs = require('fs');

const DYNAMODB_TABLE = 'ShoppingCart';
const DATA_FILE      = 'CartData.csv';

console.log('Loading file: ' + DATA_FILE + ' into table: ' + DYNAMODB_TABLE );
console.log();

const docClient = new AWS.DynamoDB.DocumentClient();

let Item = {}; // this obj will be filled with key-value pairs from the data file


fs.readFile(DATA_FILE, 'utf8', function(err, rawData) {
    let newLineSignal = '\n';

    if(rawData.search('\r\n') > 0) {
        newLineSignal = '\r\n';
    }
    const fileLines = rawData.split(newLineSignal);

    if(fileLines.length < 2) {
        console.log('The CSV file ' + DATA_FILE + ' should have column headers on line 1 and data starting on line 2');

    } else {

        const attrNamesQuoted = fileLines[0].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);

        let attrNames = [];
        for(let a=0; a < attrNamesQuoted.length; a++) {
            // console.log(attrNamesQuoted[a]);

            attrNames.push(stripQuotes(attrNamesQuoted[a]));
        }

        const linesToProcess = fileLines.length;
        // const linesToProcess = 3;

        for(let i = 1; i < linesToProcess; i++) {
            Item = {};

            // const attrData = fileLines[i]
            //     .replace(/,,/g, ',null,')
            //     .match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);

            const attrData = fileLines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);

            // console.log();
            // console.log( fileLines[i]);
            // console.log( attrData);

            if(attrData) {
                for(let j = 0; j < attrData.length; j++) {

                    let attr = stripQuotes(attrData[j]);

                    // console.log(attr + ' ' + typeof attr);
                    if(attr.length > 0) {

                        if(!isNaN(attr)) {
                            attr = attr * 1; // convert to number
                            Item[attrNames[j]] = attr;

                        } else {

                            if(attr.charAt(0) === '{' && attr.charAt(attr.length-1) === '}') {
                                // JSON object within string
                                const obj = JSON.parse(attr.replace(/""/g,'"'));
                                console.log('\n^^^^ obj: ' + obj);

                                Item[attrNames[j]] = obj;

                            } else {
                                Item[attrNames[j]] = attr;
                            }
                        }

                    }


                }
                // console.log(JSON.stringify(Item));

                const paramsPut = {
                    TableName: DYNAMODB_TABLE,
                    Item: Item
                };

                console.log('\n***** paramsPut');
                console.log(paramsPut);
                console.log();

                docClient.put(paramsPut, function (err, data) {
                    if (err) {
                        console.error("Unable to put item. Error JSON:", JSON.stringify(err, null, 2));
                        return 'error';

                    } else {
                        console.log("UpdateItem succeeded:", JSON.stringify(paramsPut.Item, null, 2));

                    }
                });

            }
        }
    }
});

function stripQuotes(str) {
    return str.replace(/^"(.*)"$/, '$1'); // strip quotes
}


